## **Local Server IP**:
  - 192.168.0.9 (Beelink N150, static)

## **NAS IP**:
  - 192.168.0.8 (TrueNAS Scale, static)

## **Local Network**:
  - Primary LAN: 192.168.0.0/24 (direct from OPNsense vtnet1)
  - Upstairs isolated: 192.168.20.0/24 (OPT1) → 192.168.30.0/24 (NF18Mesh)

## **Public IP**:
  - 180.150.66.156

## **Port Forwarding** (Direct on OPNsense WAN):
  - TCP 80/443 → 192.168.0.9:80/443 (Caddy/Jellyfin external access)
  - TCP/UDP 6881 → 192.168.0.9:6881 (qBittorrent incoming peers, direct/no VPN)
  - TCP 50300 → 192.168.0.9:50300 (slskd active incoming peers for direct transfers)

## **DHCP**:
  - Backend: Dnsmasq (migrated for integrated DHCP + local DNS hostname registration)
  - Enabled on LAN (vtnet1) and OPT1 (vtnet2)
  - General Settings:
    - Domain: tourmaline.lan
    - Listen port: 53053 (avoids conflict with Unbound on 53)
    - DHCP FQDN enabled
    - Interfaces: LAN + OPT1 selected
    - Strict binding enabled
    - DHCP firewall rules auto-registered
  - IPv4 Ranges:
    - LAN: 192.168.0.50 to 192.168.0.250 (domain tourmaline.lan; lease time 3600s)
    - OPT1: 192.168.20.10 to 192.168.20.250 (domain tourmaline.lan; lease time 3600s)
  - IPv6 Ranges (stateless SLAAC only):
    - LAN: Start :: (blank end), Constructor LAN, RA Mode ra-stateless, ra-names checked, Advanced Mode enabled, Domain Type Interface, Domain blank (to avoid conflict with IPv4 tourmaline.lan)
    - OPT1: No IPv6 range (IPv6 disabled on OPT1/NF18 for isolation)
  - DHCP Options:
    - Option6 dns-server [23], Interface any, Value [::] (advertises router GUA → Unbound for IPv6 DNS/blocklists)
  - Static mappings: Critical devices reserved via Hosts tab (MAC-based with hostnames, e.g., TrueNAS 192.168.0.8)
  - Connector with Unbound: Unbound forwards local queries (tourmaline.lan + reverses) to 127.0.0.1:53053 for hostname resolution from leases/statics
  - Lease management: Services → Dnsmasq → Leases tab → Delete old entry to force fresh offer on renew

## **DNS Resolver (Unbound)**:
  - Primary client-facing resolver (port 53)
  - Features: OISD blocklist, Quad9 DoT forwarding, DNSSEC validation, NAT redirects forcing DNS to router IP
  - Query Forwarding: tourmaline.lan + reverse zones (0.168.192.in-addr.arpa, 20.168.192.in-addr.arpa) to 127.0.0.1:53053
  - Register DHCP leases/static mappings: Unchecked (handled by Dnsmasq)

## **IPv6 Configuration** (Native dual-stack on LAN only):
  - WAN (vtnet0): DHCPv6 with "Request only an IPv6 prefix" and "Send prefix hint" enabled (delegates /48 from Aussie Broadband)
  - LAN (vtnet1): Track Interface (WAN) with Prefix ID 11; Manual configuration unchecked (auto mode)
  - OPT1 (vtnet2): Static IPv6 (no tracking/delegation; NF18 IPv6 disabled for isolation)
  - Router Advertisements: Handled by Dnsmasq (radvd disabled globally)
    - Stateless SLAAC via ra-stateless + dns-server [23] [::]
    - Clients receive globals in 2403:5807:8d14:11::/64 range
    - DNS advertised via option [23] (Unbound caching/TLS/blocklists active over IPv6)
  - Status: Functional and stable on downstairs LAN (globals persistent, renew reliable); upstairs/OPT1 intentionally no IPv6

## **GL.iNet GL-MT6000 (Flint 2) Downstairs AP**:
  - Mode: Dumb AP (OpenWrt 23.05+ custom build, pure L2 bridge—no routing/DHCP/NAT/firewall)
  - Management IP: Static 192.168.0.254/24 (gateway/DNS 192.168.0.1 for AP updates/NTP)
  - Uplink: LAN port to keepLiNK switch (replaces Tenda MX12)
  - WiFi Configuration:
    - Dual-band same SSID for seamless band steering
    - SSID: "INFINITE AURA" (exact caps/spaces)
    - Encryption: WPA2-PSK
    - Key: Awkward88!!! (exact)
    - 2.4GHz (radio0): Channel 11, 20 MHz width (legacy/IoT compatibility)
    - 5GHz (radio1): Channel auto, 80 MHz width (WiFi 6 speed boost)
  - Country Code: AU (full legal power/channels)
  - Firewall: Transparent (lan zone forward reject, no wan zone)
  - IPv6: Disabled (delegation off—handled centrally by OPNsense)

## **keepLiNK Switch**:
  - Core downstairs switch, IP 192.168.0.10, MAC 78:D8:00:32:3C:FA
  - Firmware: V100.9.9.1.7 (June 7 2025), hardware V3.1
  - Connections: Flint 2 uplink to RJ45 port 8; Beelink bond0 to ports 3-4 via static Trunk2; NAS bond1 to ports 1-2 via LACP Trunk1
  - Critical note: After any power loss, static Trunk2 may lose state (ports treated independently). Recreate Trunk2 in GUI and ALWAYS click "Save Configuration" to flash. This restores balance-rr aggregation instantly.

## **TP-Link LiteWave LS105GP**:
  - 5-Port PoE Switch (ports 1-4 PoE, port 5 non-PoE), daisy-chained to keepLiNK
  - Use: Powering 2 SMLight devices (ports 3-4): SLZB-06M in Zigbee mode (dynamic IP 192.168.0.12, MAC 0C:DC:7E:36:E5:D7, port 6638, baudrate 115200, adapter ember, firmware OS v3.1.3/Zigbee 20250220); other as Bluetooth mesh hub

## **Realtek RTL8156 USB 2.5G Dongles (Beelink)**:
  - MACs: 00:e0:4c:68:00:5f and 00:e0:4c:68:00:99
  - Configuration: Bonded as bond0 balance-rr static aggregation
  - Driver: Official Realtek r8152 v2.21.4 (Nov 2025) installed offline—replaces in-tree module for reliable full-duplex 2.5G negotiation (prevents half-duplex fallback after link events). Includes 50-usb-realtek-net.rules for stable interface naming.

## **Tailscale (Mesh VPN for Remote Access)**:
  - Installed on Beelink, CHOCKSMAINPC, phone, Proxmox WAN PC (including OPNsense VM) (free personal plan)
  - OPNsense config: Plugin interface OPT2 "TAIL" (prevent removal ticked)
  - Firewall Rules: TAIL interface pass inbound TCP from any to This Firewall ports 8443 (custom web GUI) + 22 (SSH)
  - Web GUI Binding: Listen Interfaces All (includes TAIL)
  - Tailnet IPs: CHOCKSMAINPC 100.108.206.83, Beelink 100.75.79.68, Phone 100.64.40.62, Proxmox WAN PC 100.112.76.14
  - MagicDNS: proxmox-wan.tail9c7840.ts.net, opnsense-wan.tail9c7840.ts.net:8443

## **Proxmox WAN PC (Upstairs WAN Entry)**:
  - Hardware: ASUS Sabertooth X79 motherboard; i7-4930K CPU; 16GB RAM; 950W PSU (water-cooled)
  - NICs: Silicom Quad Port 10GB PCIe RJ45 X540-T4 (nic0 WAN, nic1 LAN, nic2 OPT1, nic3 spare); onboard Intel 82579V Gigabit (eno1 management to NF18)
  - Software: Proxmox VE 9.1.1; GRUB bootloader
  - Networks (VirtIO bridges):
    - vmbr0: manual, bridge-ports nic0 (WAN to NTD UNI-D 1)
    - vmbr1: manual, bridge-ports nic1 (LAN downstairs)
    - vmbr2: manual, bridge-ports nic2 (OPT1 to NF18 WAN)
    - vmbr3: dhcp, bridge-ports eno1 (management from NF18 192.168.30.x)
    - nic3: Spare (roadmap cable testing)

## **Virtual Machines**:
  - OPNsense: VMID 100, 4 cores, 8GB RAM, 50GB SCSI disk, version 26.1.2
    - Web GUI: Custom TCP port 8443 (HTTPS; Listen Interfaces All)
    - Machine Type: q35
    - Networks: VirtIO (vtnet0 WAN, vtnet1 LAN, vtnet2 OPT1, OPT2 TAIL locked)
    - Auto-Start: Enabled
    - Interfaces: WAN DHCP public IP; LAN static 192.168.0.1/24; OPT1 static 192.168.0.1/24; TAIL Tailscale plugin
    - Security: OPT1 restricted (block OPT1 to LAN rule); Proxmox host firewall enabled
  - Home Assistant: Dedicated NIC enp2s0: NAS_ETHERNET (bypasses LACP/bond1 for direct host access; no failover needed)

## **Netcomm NF18Mesh Modem**:
  - Location: Upstairs
  - Mode: Double NAT (WAN static 192.168.20.12 from OPNsense, LAN 192.168.30.1/24 with DHCP 192.168.30.10-250)
  - GUI port 80; WiFi enabled; firewall disabled
  - Static route: 192.168.0.0/24 via 192.168.20.1
  - DHCP reservation: Dad's PC 192.168.30.3
  - Port forwards: RDP 3389 TCP/UDP to 192.168.30.3:3389; Proxmox GUI 8006 TCP to 192.168.30.14:8006; Proxmox SSH 2222 TCP to 192.168.30.14:22
  - WAN services: ICMP/HTTP enabled with ACL restricted to 192.168.0.0/24
  - Firmware: NF18MESH.NC.ABB-R6B016.EN (latest per Aussie Broadband Sep 2025)

## **External Domains**:
  - jellyfin.csokonay.online → 180.150.66.156 (A)
  - sonarr.csokonay.online → 180.150.66.156 (A)
  - prowlarr.csokonay.online → 180.150.66.156 (A)
  - radarr.csokonay.online → 180.150.66.156 (A)
  - media.csokonay.online → 180.150.66.156 (A)
  - ma.csokonay.online → 180.150.66.156 (A)
  - shoddy88.duckdns.org (static response)

## **Firewall (Beelink UFW)** (updated 2026-02-12):
- Status: Active
- Default policy: Deny incoming, allow outgoing
- Rules (IPv4):
  — External (Anywhere):
  80/tcp # Caddy external HTTP
  443/tcp # Caddy external HTTPS
  8096/tcp # Jellyfin direct access
  6881/tcp # qBittorrent incoming peers TCP
  6881/udp # qBittorrent incoming peers UDP
  — LAN-restricted (192.168.0.0/24):
  22/tcp # SSH from LAN only
  Samba # SMB shares on Beelink
  5004/tcp # Tdarr Inform API/UI
  5030 # slskd web UI
  5030/tcp # slskd (duplicate, specific protocol)
  5031/tcp # slskd HTTPS server
  5201 # iperf testing
  7575 # Homarr UI
  7878/tcp # Radarr web UI
  7879/tcp # Radarr4K web UI
  8080/tcp # qBittorrent web UI
  8085/tcp # SABnzbd web UI
  8265/tcp # Tdarr web UI (Homarr needs it for Tdarr info)
  8266/tcp # Tdarr server
  8686/tcp # Lidarr web UI
  8989/tcp # Sonarr web UI
  9696/tcp # Prowlarr web UI
  4533 # Navidrome
  3000 # Aurral UI
  3001/tcp # Dashdot
  — Docker bridge (172.16.0.0/12):
  7878,7879,8080,8085,8989,9696/tcp # Docker containers → host web UIs for healthchecks/stack-monitor
  5004/tcp # Tdarr Inform API/UI – Docker containers to host
  5030 # slskd Docker bridge
  5031 # slskd HTTPS Docker bridge
  8265:8266/tcp # Tdarr inter-docker comms
  8686 # Lidarr Docker bridge
- Rules (IPv6):
  Public (Anywhere (v6)): 80/tcp, 443/tcp, 8096/tcp # Caddy external HTTP/HTTPS + Jellyfin direct
  6881/tcp, 6881/udp # qBittorrent incoming peers TCP/UDP
  LAN-restricted (2403:5807:8d14:11::/64): 22/tcp (SSH), 8686/tcp (Lidarr), 7878/tcp (Radarr), 7879/tcp (Radarr4K), Samba (SMB), 8989/tcp (Sonarr), 9696/tcp (Prowlarr), 8080/tcp (qBittorrent), 8085/tcp (SABnzbd), 8265/tcp (Tdarr), 5004/tcp (Tdarr Inform)
- Notes:
  - External access primarily via Caddy on 443 (dual-stack).
  - qBittorrent peers: Port 6881 TCP+UDP; IPv6 direct inbound after OPNsense WAN rule (IPv4 blocked by design).
  - Docker: Broad 172.16.0.0/12 range covers all possible container networks for reliable healthchecks.
  - Shairport-sync/Snapserver/Snapcast rules removed (audio moved to Sendspin on Pis).